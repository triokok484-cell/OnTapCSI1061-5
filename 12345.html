<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSI FPTU - Công cụ Ôn tập Nâng cao</title>
    <style>
        :root {
            --fpt-blue: #0055a5;
            --fpt-orange: #f26f21;
            --info-blue: #007bff;
            --text-color: #333;
            --bg-color: #f8f9fa;
            --container-bg: #ffffff;
            --highlight-bg: #fff3cd;
            --highlight-text: #856404;
            --correct-bg: #d4edda;
            --correct-border: #c3e6cb;
            --incorrect-bg: #f8d7da;
            --incorrect-border: #f5c6cb;
            --explanation-bg: #e2e3e5;
        }
        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, 'Helvetica Neue', sans-serif;
            line-height: 1.7;
            margin: 0;
            padding: 20px;
            background-color: var(--bg-color);
            color: var(--text-color);
        }
        .container {
            max-width: 960px;
            margin: auto;
            background: var(--container-bg);
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        header {
            text-align: center;
            border-bottom: 3px solid var(--fpt-blue);
            padding-bottom: 15px;
            margin-bottom: 25px;
        }
        header h1 {
            color: var(--fpt-blue);
            margin: 0 0 5px 0;
        }
        .lang-switcher {
            margin-top: 15px;
        }
        .lang-switcher button {
            padding: 6px 12px;
            border: 1px solid #ccc;
            background-color: #f0f0f0;
            cursor: pointer;
            margin: 0 5px;
            border-radius: 5px;
            font-size: 14px;
        }
        .lang-switcher button.active {
            background-color: var(--fpt-blue);
            color: white;
            border-color: var(--fpt-blue);
        }
        .tab-nav {
            display: flex;
            margin-bottom: 25px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .tab-link {
            flex: 1;
            padding: 15px;
            cursor: pointer;
            border: none;
            background-color: #e9ecef;
            font-size: 16px;
            font-weight: 500;
            transition: background-color 0.3s, color 0.3s;
            text-align: center;
        }
        .tab-link.active {
            background-color: var(--fpt-orange);
            color: white;
        }
        .tab-link:hover:not(.active) {
            background-color: #dee2e6;
        }
        .tab-pane { display: none; }
        .tab-pane.active { display: block; }
        
        .theory-content h2 { color: var(--fpt-blue); border-bottom: 2px solid var(--fpt-orange); padding-bottom: 5px; }
        .theory-content h3 { color: #333; margin-top: 25px; }
        .theory-content ul { list-style-type: none; padding-left: 0; }
        .theory-content li { background: #f8f9fa; margin-bottom: 10px; padding: 15px; border-left: 4px solid var(--fpt-blue); border-radius: 5px; }
        .theory-content ul ul { margin-top: 10px; }
        .theory-content li li { background: #e9ecef; border-left-color: var(--fpt-orange); }
        .theory-content code, .theory-content pre {
            font-family: Consolas, 'Courier New', monospace;
            background-color: #e9ecef;
            padding: 2px 5px;
            border-radius: 4px;
        }
        .theory-content pre {
            padding: 15px;
            line-height: 1.5;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .highlight {
            background-color: var(--highlight-bg);
            padding: 3px 6px;
            border-radius: 4px;
            font-weight: bold;
            color: var(--highlight-text);
        }
        .quiz-view, .quiz-setup, .quiz-results { display: none; }
        .quiz-container, .quiz-setup, .quiz-results {
            border: 1px solid #dee2e6;
            padding: 25px;
            margin-top: 25px;
            border-radius: 8px;
            background-color: #fafafa;
        }
        .quiz-question {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 20px;
        }
        .quiz-options button {
            display: block;
            width: 100%;
            text-align: left;
            padding: 14px;
            margin: 8px 0;
            border: 1px solid #ccc;
            background-color: var(--container-bg);
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
            font-size: 16px;
        }
        .quiz-options button:hover:not([disabled]) {
            background-color: #e9e9e9;
            border-color: #aaa;
        }
        .quiz-options button.correct {
            background-color: var(--correct-bg);
            border-color: var(--correct-border);
            font-weight: bold;
        }
        .quiz-options button.incorrect {
            background-color: var(--incorrect-bg);
            border-color: var(--incorrect-border);
        }
        .explanation-box {
            margin-top: 15px;
            padding: 15px;
            background-color: var(--explanation-bg);
            border-radius: 6px;
            border: 1px solid #ced4da;
        }
        .button-group button, .quiz-setup button, .quiz-results button, .quiz-setup input {
            padding: 12px 22px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 6px;
            margin: 10px 5px 10px 0;
            border: none;
            font-weight: 500;
        }
        .quiz-setup input {
            width: 80px;
            border: 1px solid #ccc;
            border-radius: 6px;
            text-align: center;
        }
        .primary-button { background-color: var(--fpt-blue); color: white; }
        .secondary-button { background-color: #6c757d; color: white; }
        .info-button { background-color: var(--info-blue); color: white; }
    </style>
    <script>
        // --- START: NGÂN HÀNG CÂU HỎI VÀ LÝ THUYẾT ---
        const contentData = {
            chapter1: {
                theory: {
                    vi: `
                        <h2>Chương 1: Giới thiệu Tổng quan</h2>
                        <h3>1. Các mô hình máy tính cơ bản</h3>
                        <ul>
                            <li>
                                <strong>Mô hình Turing (Turing Model):</strong>
                                <ul>
                                    <li>Định nghĩa máy tính như một <span class="highlight">bộ xử lý dữ liệu có thể lập trình được (programmable data processor)</span>.</li>
                                    <li>Đây là một mô hình lý thuyết, toán học, không phải kiến trúc vật lý.</li>
                                    <li>Công thức cốt lõi: <strong>Dữ liệu đầu vào + Chương trình -> Máy tính -> Dữ liệu đầu ra</strong>.</li>
                                    <li>Ý nghĩa: Cùng một dữ liệu đầu vào, nếu thay đổi chương trình, ta sẽ có kết quả đầu ra khác nhau. Điều này định nghĩa nên một máy tính đa năng (general-purpose).</li>
                                </ul>
                            </li>
                            <li>
                                <strong>Mô hình von Neumann (von Neumann Model):</strong>
                                <ul>
                                    <li>Mô hình kiến trúc cho hầu hết các máy tính hiện đại.</li>
                                    <li><span class="highlight">Khái niệm đột phá: Chương trình được lưu trong bộ nhớ (Stored Program Concept)</span>. Cả chương trình (tập lệnh) và dữ liệu đều được lưu trữ trong cùng một bộ nhớ và có cùng định dạng (nhị phân).</li>
                                    <li>Kiến trúc bao gồm 4 hệ thống con (subsystems):
                                        <ol>
                                            <li><strong>Bộ nhớ (Memory):</strong> Lưu trữ chương trình và dữ liệu.</li>
                                            <li><strong>Đơn vị Số học & Logic (Arithmetic Logic Unit - ALU):</strong> Thực hiện các phép tính và so sánh logic.</li>
                                            <li><strong>Đơn vị Điều khiển (Control Unit):</strong> Điều phối hoạt động của tất cả các thành phần khác.</li>
                                            <li><strong>Hệ thống Vào/Ra (Input/Output Subsystem):</strong> Giao tiếp với thế giới bên ngoài (bàn phím, màn hình, ổ cứng...).</li>
                                        </ol>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                        <h3>2. Ba thành phần của máy tính</h3>
                        <ul>
                            <li><strong>Phần cứng (Hardware):</strong> Các thành phần vật lý của máy tính (CPU, RAM, ổ đĩa, ...).</li>
                            <li><strong>Dữ liệu (Data):</strong> Các thông tin thô (số, văn bản, hình ảnh) được máy tính xử lý. Dữ liệu được biểu diễn dưới dạng nhị phân.</li>
                            <li><strong>Phần mềm (Software):</strong> Tập hợp các chương trình (tập lệnh) hướng dẫn phần cứng phải làm gì. Phần mềm là cầu nối giữa người dùng và phần cứng.</li>
                        </ul>
                        <h3>3. Lược sử máy tính</h3>
                        <ul>
                            <li><strong>Giai đoạn 1: Máy cơ học (Trước 1930):</strong> Pascaline, Leibniz Wheel, Analytical Engine của Babbage.</li>
                            <li><strong>Giai đoạn 2: Máy tính điện tử ra đời (1930-1950):</strong> ENIAC (máy tính điện tử đa năng đầu tiên), Colossus.</li>
                            <li><strong>Giai đoạn 3: Các thế hệ máy tính (1950-nay):</strong>
                                <ul>
                                    <li><strong>Thế hệ 1 (1950-1959):</strong> Dùng bóng chân không (vacuum tubes), kích thước lớn, tiêu thụ nhiều điện.</li>
                                    <li><strong>Thế hệ 2 (1959-1965):</strong> Dùng <span class="highlight">bóng bán dẫn (transistors)</span>, nhỏ hơn, nhanh hơn, rẻ hơn.</li>
                                    <li><strong>Thế hệ 3 (1965-1975):</strong> Dùng <span class="highlight">mạch tích hợp (Integrated Circuits - IC)</span>.</li>
                                    <li><strong>Thế hệ 4 (1975-1985):</strong> Dùng <span class="highlight">vi xử lý (microprocessors)</span>, dẫn đến sự ra đời của máy tính cá nhân.</li>
                                    <li><strong>Thế hệ 5 (1985-nay):</strong> Sự bùng nổ của máy tính xách tay, mạng máy tính, internet, và trí tuệ nhân tạo.</li>
                                </ul>
                            </li>
                        </ul>
                    `,
                    en: `
                        <h2>Chapter 1: Introduction</h2>
                        <h3>1. Basic Computer Models</h3>
                        <ul>
                            <li>
                                <strong>Turing Model:</strong>
                                <ul>
                                    <li>Defines a computer as a <span class="highlight">programmable data processor</span>.</li>
                                    <li>This is a theoretical, mathematical model, not a physical architecture.</li>
                                    <li>Core formula: <strong>Input Data + Program -> Computer -> Output Data</strong>.</li>
                                    <li>Significance: With the same input data, changing the program yields a different output. This defines a general-purpose computer.</li>
                                </ul>
                            </li>
                            <li>
                                <strong>von Neumann Model:</strong>
                                <ul>
                                    <li>The architectural model for most modern computers.</li>
                                    <li><span class="highlight">Breakthrough concept: The Stored Program Concept</span>. Both the program (instructions) and data are stored in the same memory and share the same format (binary).</li>
                                    <li>The architecture consists of four subsystems:
                                        <ol>
                                            <li><strong>Memory:</strong> Stores programs and data.</li>
                                            <li><strong>Arithmetic Logic Unit (ALU):</strong> Performs calculations and logical comparisons.</li>
                                            <li><strong>Control Unit:</strong> Coordinates the operations of all other components.</li>
                                            <li><strong>Input/Output (I/O) Subsystem:</strong> Communicates with the outside world (keyboard, monitor, drives...).</li>
                                        </ol>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                        <h3>2. Three Components of a Computer</h3>
                        <ul>
                            <li><strong>Hardware:</strong> The physical parts of the computer (CPU, RAM, disk drive, etc.).</li>
                            <li><strong>Data:</strong> Raw information (numbers, text, images) that the computer processes. Data is represented in binary format.</li>
                            <li><strong>Software:</strong> A collection of programs (sets of instructions) that tells the hardware what to do. Software is the bridge between the user and the hardware.</li>
                        </ul>
                        <h3>3. A Brief History of Computers</h3>
                        <ul>
                            <li><strong>Period 1: Mechanical Machines (Before 1930):</strong> Pascaline, Leibniz Wheel, Babbage's Analytical Engine.</li>
                            <li><strong>Period 2: The Birth of Electronic Computers (1930-1950):</strong> ENIAC (first general-purpose electronic computer), Colossus.</li>
                            <li><strong>Period 3: Computer Generations (1950-Present):</strong>
                                <ul>
                                    <li><strong>1st Gen (1950-1959):</strong> Used vacuum tubes, large size, high power consumption.</li>
                                    <li><strong>2nd Gen (1959-1965):</strong> Used <span class="highlight">transistors</span>, smaller, faster, cheaper.</li>
                                    <li><strong>3rd Gen (1965-1975):</strong> Used <span class="highlight">Integrated Circuits (ICs)</span>.</li>
                                    <li><strong>4th Gen (1975-1985):</strong> Used <span class="highlight">microprocessors</span>, leading to personal computers.</li>
                                    <li><strong>5th Gen (1985-Present):</strong> Boom of laptops, networks, the internet, and AI.</li>
                                </ul>
                            </li>
                        </ul>
                    `
                },
                questions: [
                    // --- Start Chapter 1 Questions ---
                    { q: { vi: "Mô hình nào định nghĩa khái niệm 'Stored Program Concept' (Chương trình được lưu trong bộ nhớ)?", en: "Which model defines the 'Stored Program Concept'?" }, o: [{ vi: "Mô hình Turing", en: "Turing Model" }, { vi: "Mô hình von Neumann", en: "von Neumann Model" }, { vi: "Mô hình Pascal", en: "Pascal Model" }, { vi: "Mô hình Babbage", en: "Babbage Model" }], a: 1, explanation: { vi: "Ghi nhớ: Von Neumann = Chương trình trong Bộ nhớ. Đây là kiến trúc máy tính hiện đại.", en: "Remember: Von Neumann = Program in Memory. This is the modern computer architecture." } },
                    { q: { vi: "Theo mô hình Turing, đầu ra phụ thuộc vào yếu tố nào?", en: "According to the Turing model, what does the output depend on?" }, o: [{ vi: "Chỉ dữ liệu đầu vào", en: "Only the input data" }, { vi: "Chỉ chương trình", en: "Only the program" }, { vi: "Sự kết hợp của dữ liệu đầu vào và chương trình", en: "The combination of input data and the program" }, { vi: "Tốc độ của máy tính", en: "The speed of the computer" }], a: 2, explanation: { vi: "Máy Turing là một 'bộ xử lý dữ liệu LẬP TRÌNH ĐƯỢC'. 'Lập trình được' có nghĩa là chương trình quyết định cách xử lý dữ liệu.", en: "A Turing machine is a 'PROGRAMMABLE data processor'. 'Programmable' means the program dictates how the data is handled." } },
                    { q: { vi: "Bốn thành phần của máy tính theo kiến trúc von Neumann là gì?", en: "What are the four components of a computer according to the von Neumann architecture?"}, o: [ {vi: "CPU, RAM, Bàn phím, Màn hình", en: "CPU, RAM, Keyboard, Monitor"}, {vi: "Bộ nhớ, ALU, Đơn vị điều khiển, Thiết bị Vào/Ra", en: "Memory, ALU, Control Unit, Input/Output Subsystem"}, {vi: "Phần cứng, Phần mềm, Dữ liệu, Mạng", en: "Hardware, Software, Data, Network"}, {vi: "Hệ điều hành, Ứng dụng, Driver, Firmware", en: "Operating System, Application, Driver, Firmware"}], a: 1, explanation: {vi: "Kiến trúc von Neumann định nghĩa 4 khối chức năng chính: Memory (bộ nhớ), ALU (đơn vị số học logic), Control Unit (đơn vị điều khiển), và I/O (vào/ra).", en: "The von Neumann architecture defines 4 main functional blocks: Memory, ALU (Arithmetic Logic Unit), Control Unit, and I/O (Input/Output)."}},
                    { q: { vi: "Thành phần nào của CPU chịu trách nhiệm thực hiện các phép toán số học và logic?", en: "Which component of the CPU is responsible for performing arithmetic and logic operations?"}, o: [ {vi: "Control Unit", en: "Control Unit"}, {vi: "Registers", en: "Registers"}, {vi: "ALU (Arithmetic Logic Unit)", en: "ALU (Arithmetic Logic Unit)"}, {vi: "Main Memory", en: "Main Memory"}], a: 2, explanation: {vi: "ALU là viết tắt của Arithmetic Logic Unit, chuyên thực hiện các phép tính toán (+, -, *, /) và các phép so sánh logic (AND, OR, NOT).", en: "ALU stands for Arithmetic Logic Unit, which specializes in performing calculations (+, -, *, /) and logical operations (AND, OR, NOT)."}},
                    { q: { vi: "Sự khác biệt chính giữa máy tính đa năng (general-purpose) và máy tính chuyên dụng (specific-purpose) là gì?", en: "What is the main difference between a general-purpose and a specific-purpose computer?"}, o: [ {vi: "Kích thước vật lý", en: "Physical size"}, {vi: "Khả năng chạy các chương trình khác nhau", en: "The ability to run different programs"}, {vi: "Giá thành", en: "Cost"}, {vi: "Tốc độ xử lý", en: "Processing speed"}], a: 1, explanation: {vi: "Máy tính đa năng (như PC) có thể thực hiện nhiều tác vụ bằng cách chạy các chương trình khác nhau. Máy tính chuyên dụng (như máy tính trong lò vi sóng) chỉ được thiết kế cho một nhiệm vụ duy nhất.", en: "A general-purpose computer (like a PC) can perform many tasks by running different programs. A specific-purpose computer (like one in a microwave) is designed for only one task."}},
                    // ... (Thêm các câu hỏi khác của Chương 1 vào đây)
                ]
            },
            chapter2: {
                 theory: {
                     vi: `
                        <h2>Chương 2: Hệ thống Số</h2>
                        <h3>1. Các hệ đếm cơ bản (Positional Number Systems)</h3>
                        <ul>
                            <li><strong>Khái niệm:</strong> Giá trị của một chữ số phụ thuộc vào <span class="highlight">vị trí (position)</span> của nó trong chuỗi số. Mỗi vị trí có một trọng số (place value) là lũy thừa của cơ số (base/radix).</li>
                            <li><strong>Các hệ đếm chính:</strong>
                                <ul>
                                    <li><strong>Thập phân (Decimal - Base 10):</strong> Dùng 10 ký tự {0, 1, ..., 9}.</li>
                                    <li><strong>Nhị phân (Binary - Base 2):</strong> Dùng 2 ký tự {0, 1}. Đây là <span class="highlight">ngôn ngữ tự nhiên của máy tính</span>.</li>
                                    <li><strong>Bát phân (Octal - Base 8):</strong> Dùng 8 ký tự {0, 1, ..., 7}.</li>
                                    <li><strong>Thập lục phân (Hexadecimal - Base 16):</strong> Dùng 16 ký tự {0, 1, ..., 9, A, B, C, D, E, F}.</li>
                                </ul>
                            </li>
                        </ul>
                        <h3>2. Ví dụ về Chuyển đổi</h3>
                        <h4>Chuyển từ hệ bất kỳ sang Thập phân</h4>
                        <p>Quy tắc: Lấy từng chữ số nhân với (cơ số)<sup>vị trí</sup> rồi cộng tất cả lại.</p>
                        <pre><strong>Ví dụ 1: (11001)₂ sang thập phân</strong>
N = 1×2⁴ + 1×2³ + 0×2² + 0×2¹ + 1×2⁰
  = 16  +  8   +  0   +  0   +  1
  = 25₁₀

<strong>Ví dụ 2: (2AE)₁₆ sang thập phân (A=10, E=14)</strong>
N = 2×16² + 10×16¹ + 14×16⁰
  = 2×256 + 10×16  + 14×1
  = 512   + 160    + 14
  = 686₁₀</pre>
                        <h4>Chuyển từ Thập phân sang hệ bất kỳ (Phần nguyên)</h4>
                        <p>Quy tắc: <span class="highlight">Chia liên tiếp</span> cho cơ số mới, lấy phần dư theo thứ tự ngược lại.</p>
                        <pre><strong>Ví dụ: 35₁₀ sang nhị phân (chia cho 2)</strong>
35 / 2 = 17 dư 1  ↑
17 / 2 = 8  dư 1  |
 8 / 2 = 4  dư 0  | Đọc ngược
 4 / 2 = 2  dư 0  | từ dưới lên
 2 / 2 = 1  dư 0  |
 1 / 2 = 0  dư 1  ↑
Kết quả: (100011)₂</pre>
                        <h4>Chuyển đổi nhanh giữa Binary ↔ Octal ↔ Hexadecimal</h4>
                        <p>Quy tắc: Gom nhóm <span class="highlight">3 bits</span> cho Octal và <span class="highlight">4 bits</span> cho Hexadecimal.</p>
                        <pre><strong>Ví dụ 1: (10011100010)₂ sang Hexadecimal (gom nhóm 4)</strong>
   100  1110  0010   (Thêm 2 số 0 vào đầu cho đủ nhóm)
→ 0100  1110  0010
    ↓     ↓     ↓
    4     E     2
Kết quả: (4E2)₁₆

<strong>Ví dụ 2: (101110010)₂ sang Octal (gom nhóm 3)</strong>
  101  110  010
   ↓    ↓    ↓
   5    6    2
Kết quả: (562)₈</pre>
                    `,
                    en: `
                        <h2>Chapter 2: Number Systems</h2>
                        <h3>1. Positional Number Systems</h3>
                        <ul>
                            <li><strong>Concept:</strong> The value of a digit depends on its <span class="highlight">position</span> within the number string. Each position has a place value, which is a power of the base (radix).</li>
                            <li><strong>Main Systems:</strong>
                                <ul>
                                    <li><strong>Decimal (Base 10):</strong> Uses 10 symbols {0, 1, ..., 9}.</li>
                                    <li><strong>Binary (Base 2):</strong> Uses 2 symbols {0, 1}. This is the <span class="highlight">natural language of computers</span>.</li>
                                    <li><strong>Octal (Base 8):</strong> Uses 8 symbols {0, 1, ..., 7}.</li>
                                    <li><strong>Hexadecimal (Base 16):</strong> Uses 16 symbols {0, 1, ..., 9, A, B, C, D, E, F}.</li>
                                </ul>
                            </li>
                        </ul>
                        <h3>2. Conversion Examples</h3>
                        <h4>Convert from Any Base to Decimal</h4>
                        <p>Rule: Multiply each digit by (base)<sup>position</sup> and sum the results.</p>
                        <pre><strong>Example 1: (11001)₂ to decimal</strong>
N = 1×2⁴ + 1×2³ + 0×2² + 0×2¹ + 1×2⁰
  = 16  +  8   +  0   +  0   +  1
  = 25₁₀

<strong>Example 2: (2AE)₁₆ to decimal (A=10, E=14)</strong>
N = 2×16² + 10×16¹ + 14×16⁰
  = 2×256 + 10×16  + 14×1
  = 512   + 160    + 14
  = 686₁₀</pre>
                        <h4>Convert from Decimal to Any Base (Integer Part)</h4>
                        <p>Rule: <span class="highlight">Repeatedly divide</span> by the new base, take the remainders in reverse order.</p>
                        <pre><strong>Example: 35₁₀ to binary (divide by 2)</strong>
35 / 2 = 17 rem 1  ↑
17 / 2 = 8  rem 1  |
 8 / 2 = 4  rem 0  | Read in reverse
 4 / 2 = 2  rem 0  | order
 2 / 2 = 1  rem 0  |
 1 / 2 = 0  rem 1  ↑
Result: (100011)₂</pre>
                        <h4>Quick Conversion between Binary ↔ Octal ↔ Hexadecimal</h4>
                        <p>Rule: Group <span class="highlight">3 bits</span> for Octal and <span class="highlight">4 bits</span> for Hexadecimal.</p>
                        <pre><strong>Example 1: (10011100010)₂ to Hexadecimal (group of 4)</strong>
   100  1110  0010   (Pad with two leading zeros)
→ 0100  1110  0010
    ↓     ↓     ↓
    4     E     2
Result: (4E2)₁₆

<strong>Example 2: (101110010)₂ to Octal (group of 3)</strong>
  101  110  010
   ↓    ↓    ↓
   5    6    2
Result: (562)₈</pre>
                    `
                },
                questions: [
                     // --- Start Chapter 2 Questions ---
                     { q: { vi: "Trong một hệ số vị (positional number system), radix (base) là gì?", en: "In a positional number system, what is the radix (base)?"}, o: [ {vi: "Giá trị lớn nhất có thể biểu diễn bằng một chữ số.", en: "The maximum value representable by a single digit."}, {vi: "Số chữ số tối đa cho biểu diễn số nguyên.", en: "The maximum number of digits for an integer representation."}, {vi: "Số kí hiệu (symbols) trong hệ (số lượng chữ số khác nhau).", en: "The number of symbols in the system (the count of different digits)."}, {vi: "Tổng các giá trị chữ số trong một số.", en: "The sum of the digit values in a number."}], a: 2, explanation: {vi: "Radix (base) định nghĩa số lượng ký hiệu duy nhất được sử dụng trong hệ đếm đó. Ví dụ, hệ thập phân có base 10 vì nó dùng 10 ký hiệu (0-9).", en: "The radix (base) defines the number of unique symbols used in that number system. For example, the decimal system has a base of 10 because it uses 10 symbols (0-9)."}},
                     { q: { vi: "Một chữ số thập lục phân (hex digit) tương ứng với bao nhiêu bit?", en: "One hexadecimal digit corresponds to how many bits?"}, o: [ {vi: "2 bit", en: "2 bits"}, {vi: "3 bit", en: "3 bits"}, {vi: "4 bit", en: "4 bits"}, {vi: "8 bit", en: "8 bits"}], a: 2, explanation: {vi: "Vì 16 = 2⁴, mỗi chữ số thập lục phân có thể biểu diễn một tổ hợp duy nhất của 4 bit. Đây là cơ sở cho việc chuyển đổi nhanh.", en: "Because 16 = 2⁴, each hexadecimal digit can represent a unique combination of 4 bits. This is the basis for fast conversion."}},
                     // ... (Thêm các câu hỏi khác của Chương 2 vào đây)
                ]
            },
            chapter3: {
                theory: {
                    vi: `
                        <h2>Chương 3: Lưu trữ Dữ liệu</h2>
                        <p>Chương này giải thích cách các loại dữ liệu khác nhau (số, văn bản, hình ảnh, âm thanh) được biểu diễn dưới dạng các chuỗi bit (0 và 1) để máy tính có thể lưu trữ và xử lý.</p>
                        <h3>1. Lưu trữ số nguyên (Storing Integers)</h3>
                        <ul>
                            <li><strong>Số nguyên không dấu (Unsigned Integers):</strong> Dùng để biểu diễn các số không âm (0, 1, 2, ...). Với n bit, ta có thể biểu diễn các số từ 0 đến 2ⁿ-1.</li>
                            <li><strong>Số nguyên có dấu (Signed Integers):</strong>
                                <ul>
                                    <li><strong>Dấu và Độ lớn (Sign-and-Magnitude):</strong> Dùng bit đầu tiên làm bit dấu (0=dương, 1=âm). Có nhược điểm là tồn tại hai biểu diễn cho số 0 (+0 và -0).</li>
                                    <li><strong>Bù 2 (Two's Complement):</strong> Phương pháp tiêu chuẩn hiện nay. Nó chỉ có một biểu diễn cho số 0 và giúp đơn giản hóa các phép toán trừ (bằng cách chuyển chúng thành phép cộng).</li>
                                </ul>
                            </li>
                        </ul>
                        <h3>2. Lưu trữ số thực (Storing Reals)</h3>
                        <ul>
                            <li>Sử dụng biểu diễn <span class="highlight">Dấu phẩy động (Floating-Point)</span>, tương tự như ký hiệu khoa học.</li>
                            <li>Một số được lưu thành 3 phần: <strong>Dấu (Sign)</strong>, <strong>Số mũ (Exponent)</strong>, và <strong>Phần định trị (Mantissa)</strong>.</li>
                        </ul>
                        <h3>3. Lưu trữ các loại dữ liệu khác</h3>
                        <ul>
                            <li><strong>Văn bản (Text):</strong> Dùng các bảng mã như <span class="highlight">ASCII</span> (cho tiếng Anh) và <span class="highlight">Unicode</span> (cho đa ngôn ngữ) để ánh xạ mỗi ký tự tới một mã nhị phân.</li>
                            <li><strong>Hình ảnh, Âm thanh, Video:</strong> Dữ liệu tương tự (analog) từ thế giới thực được số hóa thông qua các quá trình <strong>Lấy mẫu (Sampling)</strong> và <strong>Lượng tử hóa (Quantization)</strong> để chuyển thành dữ liệu số (digital).</li>
                        </ul>
                    `,
                    en: `
                        <h2>Chapter 3: Data Storage</h2>
                        <p>This chapter explains how different types of data (numbers, text, images, audio) are represented as bit patterns (0s and 1s) so they can be stored and processed by a computer.</p>
                        <h3>1. Storing Integers</h3>
                        <ul>
                            <li><strong>Unsigned Integers:</strong> Used to represent non-negative numbers (0, 1, 2, ...). With n bits, numbers from 0 to 2ⁿ-1 can be represented.</li>
                            <li><strong>Signed Integers:</strong>
                                <ul>
                                    <li><strong>Sign-and-Magnitude:</strong> Uses the first bit as a sign bit (0=positive, 1=negative). It has the drawback of having two representations for zero (+0 and -0).</li>
                                    <li><strong>Two's Complement:</strong> The current standard method. It has only one representation for zero and simplifies subtraction operations (by converting them to addition).</li>
                                </ul>
                            </li>
                        </ul>
                        <h3>2. Storing Reals</h3>
                        <ul>
                            <li>Uses <span class="highlight">Floating-Point</span> representation, which is similar to scientific notation.</li>
                            <li>A number is stored in 3 parts: <strong>Sign</strong>, <strong>Exponent</strong>, and <strong>Mantissa</strong>.</li>
                        </ul>
                        <h3>3. Storing Other Data Types</h3>
                        <ul>
                            <li><strong>Text:</strong> Uses character sets like <span class="highlight">ASCII</span> (for English) and <span class="highlight">Unicode</span> (for multiple languages) to map each character to a binary code.</li>
                            <li><strong>Images, Audio, Video:</strong> Analog data from the real world is digitized through <strong>Sampling</strong> and <strong>Quantization</strong> to be converted into digital data.</li>
                        </ul>
                    `
                },
                questions: [
                    // --- Start Chapter 3 Questions ---
                    { q: { vi: "Khi được lưu trữ trong máy tính, tất cả các loại dữ liệu đều được chuyển đổi thành một dạng biểu diễn thống nhất. Dạng biểu diễn chung này được gọi là gì?", en: "When stored in a computer, all data types are converted into a uniform representation. What is this common representation called?"}, o: [{vi: "Một byte (A byte)", en: "A byte"}, {vi: "Một mẫu bit (A bit pattern)", en: "A bit pattern"}, {vi: "Một từ (A word)", en: "A word"}, {vi: "Một con số (A number)", en: "A number"}], a: 1, explanation: {vi: "Dù là số, chữ, hay hình ảnh, tất cả đều được mã hóa thành các chuỗi 0 và 1, được gọi là mẫu bit.", en: "Whether it's a number, text, or image, everything is encoded into strings of 0s and 1s, known as a bit pattern."} },
                    { q: { vi: "Hầu hết các máy tính ngày nay sử dụng phương pháp biểu diễn số nguyên nào để lưu trữ số nguyên có dấu?", en: "Which integer representation do most computers today use to store signed integers?"}, o: [{vi: "Biểu diễn không dấu (Unsigned representation)", en: "Unsigned representation"}, {vi: "Biểu diễn dấu-lượng (Sign-and-magnitude representation)", en: "Sign-and-magnitude representation"}, {vi: "Biểu diễn bù hai (Two's complement representation)", en: "Two's complement representation"}, {vi: "Biểu diễn bù một (One's complement representation)", en: "One's complement representation"}], a: 2, explanation: {vi: "Bù hai (Two's complement) là tiêu chuẩn vì nó giải quyết vấn đề hai số 0 và đơn giản hóa mạch logic cho phép trừ (biến nó thành phép cộng).", en: "Two's complement is the standard because it solves the two-zeros problem and simplifies the logic circuit for subtraction (by turning it into addition)."}},
                    // ... (Thêm các câu hỏi khác của Chương 3 vào đây)
                ]
            },
            chapter4: {
                 theory: {
                    vi: `
                        <h2>Chương 4: Các Phép toán trên Dữ liệu</h2>
                        <h3>1. Phép toán Logic (Logic Operations)</h3>
                        <ul>
                            <li>Thực hiện trên từng bit của một hoặc hai chuỗi bit. Các toán tử chính:
                                <ul>
                                    <li><strong>NOT:</strong> Đảo bit (0 thành 1, 1 thành 0).</li>
                                    <li><strong>AND:</strong> Kết quả là 1 chỉ khi cả hai bit đầu vào đều là 1.</li>
                                    <li><strong>OR:</strong> Kết quả là 1 nếu ít nhất một trong hai bit đầu vào là 1.</li>
                                    <li><strong>XOR (Exclusive OR):</strong> Kết quả là 1 chỉ khi hai bit đầu vào khác nhau.</li>
                                </ul>
                            </li>
                            <li>
                                <strong>Ứng dụng: Dùng mặt nạ (Masking)</strong>
                                <ul>
                                    <li><span class="highlight">Unsetting (Xóa bit về 0):</span> Dùng phép <strong>AND</strong> với mặt nạ có bit 0 tại vị trí cần xóa.</li>
                                    <li><span class="highlight">Setting (Bật bit lên 1):</span> Dùng phép <strong>OR</strong> với mặt nạ có bit 1 tại vị trí cần bật.</li>
                                    <li><span class="highlight">Flipping (Lật bit):</span> Dùng phép <strong>XOR</strong> với mặt nạ có bit 1 tại vị trí cần lật.</li>
                                </ul>
                            </li>
                        </ul>
                        <h3>2. Ví dụ về Masking</h3>
                        <pre><strong>Ví dụ: Xóa (unset) 5 bit ngoài cùng bên trái của 10100110</strong>
  1010 0110   (Dữ liệu gốc)
& 0000 0111   (Mặt nạ AND - 0 ở vị trí cần xóa)
-----------
  0000 0110   (Kết quả)

<strong>Ví dụ: Lật (flip) 5 bit ngoài cùng bên trái của 10100110</strong>
  1010 0110   (Dữ liệu gốc)
^ 1111 1000   (Mặt nạ XOR - 1 ở vị trí cần lật)
-----------
  0101 1110   (Kết quả)</pre>
                        <h3>3. Phép toán Dịch chuyển (Shift Operations)</h3>
                        <ul>
                             <li><strong>Dịch logic (Logical Shift):</strong> Dịch chuyển các bit, chèn số 0 vào chỗ trống. Dùng cho số không dấu.</li>
                             <li><strong>Dịch số học (Arithmetic Shift):</strong> Dùng cho số bù 2. Khi dịch phải, bit dấu được giữ nguyên để bảo toàn giá trị âm/dương. Dịch trái tương đương nhân 2, dịch phải tương đương chia 2.</li>
                        </ul>
                        <h3>4. Phép toán Số học (Arithmetic Operations)</h3>
                        <ul>
                            <li>Phép cộng số Bù 2 được thực hiện như cộng nhị phân thông thường, bit nhớ cuối cùng (nếu có) sẽ bị bỏ đi.</li>
                            <li><span class="highlight">Phép trừ A - B được thực hiện bằng phép cộng: A + (Bù 2 của B)</span>.</li>
                        </ul>
                         <pre><strong>Ví dụ: (+24) + (-17) dùng số bù 2 8-bit</strong>
+24       = 0001 1000
-17       = 1110 1111  (Bù 2 của 17)
-------------------
Kết quả: (1)0000 0111  (Bỏ bit nhớ cuối)
          = 7₁₀ (Đúng)</pre>
                    `,
                    en: `
                        <h2>Chapter 4: Operations on Data</h2>
                        <h3>1. Logic Operations</h3>
                        <ul>
                            <li>Performed on individual bits of one or two bit patterns. Main operators:
                                <ul>
                                    <li><strong>NOT:</strong> Inverts the bit (0 becomes 1, 1 becomes 0).</li>
                                    <li><strong>AND:</strong> The result is 1 only if both input bits are 1.</li>
                                    <li><strong>OR:</strong> The result is 1 if at least one of the input bits is 1.</li>
                                    <li><strong>XOR (Exclusive OR):</strong> The result is 1 only if the input bits are different.</li>
                                </ul>
                            </li>
                            <li>
                                <strong>Application: Masking</strong>
                                <ul>
                                    <li><span class="highlight">Unsetting a bit (to 0):</span> Use <strong>AND</strong> with a mask that has a 0 at the desired position.</li>
                                    <li><span class="highlight">Setting a bit (to 1):</span> Use <strong>OR</strong> with a mask that has a 1 at the desired position.</li>
                                    <li><span class="highlight">Flipping a bit:</span> Use <strong>XOR</strong> with a mask that has a 1 at the desired position.</li>
                                </ul>
                            </li>
                        </ul>
                        <h3>2. Masking Examples</h3>
                        <pre><strong>Example: Unset the five leftmost bits of 10100110</strong>
  1010 0110   (Original Data)
& 0000 0111   (AND Mask - 0s where you want to clear)
-----------
  0000 0110   (Result)

<strong>Example: Flip the five leftmost bits of 10100110</strong>
  1010 0110   (Original Data)
^ 1111 1000   (XOR Mask - 1s where you want to flip)
-----------
  0101 1110   (Result)</pre>
                        <h3>3. Shift Operations</h3>
                        <ul>
                             <li><strong>Logical Shift:</strong> Shifts bits and inserts a 0 into the empty spot. Used for unsigned numbers.</li>
                             <li><strong>Arithmetic Shift:</strong> Used for two's complement numbers. A right shift preserves the sign bit. Left shift is equivalent to multiplying by 2, right shift is equivalent to dividing by 2.</li>
                        </ul>
                        <h3>4. Arithmetic Operations</h3>
                        <ul>
                            <li>Two's Complement addition is performed like normal binary addition, and the final carry bit (if any) is discarded.</li>
                            <li><span class="highlight">Subtraction A - B is performed as an addition: A + (Two's complement of B)</span>.</li>
                        </ul>
                         <pre><strong>Example: (+24) + (-17) using 8-bit two's complement</strong>
+24       = 0001 1000
-17       = 1110 1111  (Two's complement of 17)
-------------------
Result: (1)0000 0111  (Discard final carry)
          = 7₁₀ (Correct)</pre>
                    `
                },
                questions: [
                    // --- Start Chapter 4 Questions ---
                    { q: { vi: "Phép toán nào sau đây là một phép toán một ngôi (unary operator)?", en: "Which of the following is a unary operator?" }, o: [{ vi: "AND", en: "AND" }, { vi: "OR", en: "OR" }, { vi: "XOR", en: "XOR" }, { vi: "NOT", en: "NOT" }], a: 3, explanation: { vi: "NOT là toán tử một ngôi vì nó chỉ hoạt động trên một toán hạng (một đầu vào). AND, OR, XOR là toán tử hai ngôi (cần hai đầu vào).", en: "NOT is a unary operator because it operates on only one operand (one input). AND, OR, and XOR are binary operators (requiring two inputs)." } },
                    { q: { vi: "Để 'unset' (tắt) một hoặc nhiều bit cụ thể trong một chuỗi bit (buộc chúng về 0), ta nên sử dụng phép toán nào kết hợp với một mặt nạ (mask)?", en: "To 'unset' (turn off) one or more specific bits in a bit string (forcing them to 0), which operation should be used with a mask?"}, o: [ {vi: "OR", en: "OR"}, {vi: "AND", en: "AND"}, {vi: "XOR", en: "XOR"}, {vi: "NOT", en: "NOT"}], a: 1, explanation: {vi: "Ghi nhớ: AND với 0 sẽ luôn cho kết quả là 0. Vì vậy, ta tạo một mặt nạ có bit 0 ở vị trí cần xóa và bit 1 ở các vị trí khác.", en: "Remember: ANDing with 0 always results in 0. Therefore, we create a mask with a 0 at the position to be cleared and 1s elsewhere."}},
                    // ... (Thêm các câu hỏi khác của Chương 4 vào đây)
                ]
            },
            chapter5: {
                 theory: {
                    vi: `
                        <h2>Chương 5: Tổ chức Máy tính</h2>
                        <h3>1. Các hệ thống con (Subsystems)</h3>
                        <ul>
                            <li><strong>CPU (Central Processing Unit - Bộ xử lý trung tâm):</strong> "Bộ não" của máy tính.
                                <ul>
                                    <li><strong>Thành phần:</strong> ALU, Đơn vị Điều khiển (Control Unit), và <span class="highlight">Các thanh ghi (Registers)</span>.</li>
                                    <li><strong>Thanh ghi quan trọng:</strong>
                                        <ul>
                                            <li><strong>PC (Program Counter):</strong> Chứa địa chỉ của lệnh kế tiếp sẽ được thực thi.</li>
                                            <li><strong>IR (Instruction Register):</strong> Chứa lệnh hiện tại đang được giải mã và thực thi.</li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                            <li><strong>Bộ nhớ chính (Main Memory):</strong>
                                <ul>
                                    <li>Lưu trữ chương trình và dữ liệu đang được sử dụng. Thường là RAM (Random Access Memory).</li>
                                    <li><span class="highlight">Phân cấp bộ nhớ (Memory Hierarchy):</span> <strong>Registers → Cache → Main Memory → Storage (Ổ cứng)</strong>. Tốc độ và giá thành giảm dần, trong khi dung lượng tăng dần.</li>
                                    <li><strong>Cache:</strong> Bộ nhớ đệm nhỏ, siêu nhanh, nằm giữa CPU và RAM để tăng tốc độ truy cập dữ liệu thường dùng.</li>
                                </ul>
                            </li>
                            <li><strong>Hệ thống Vào/Ra (I/O Subsystem):</strong> Gồm các thiết bị ngoại vi và các bộ điều khiển (controllers) để kết nối chúng với máy tính.</li>
                        </ul>
                        <h3>2. Chu kỳ máy (Machine Cycle)</h3>
                        <ul>
                             <li>Quá trình CPU thực thi một lệnh, lặp đi lặp lại. Gồm 3 bước cơ bản:
                                <ol>
                                    <li><span class="highlight">Fetch (Nạp lệnh):</span> CPU lấy lệnh từ bộ nhớ và đưa vào thanh ghi IR.</li>
                                    <li><span class="highlight">Decode (Giải mã):</span> Đơn vị điều khiển giải mã lệnh trong IR để biết cần làm gì.</li>
                                    <li><span class="highlight">Execute (Thực thi):</span> ALU hoặc thành phần khác thực hiện thao tác được yêu cầu.</li>
                                </ol>
                            </li>
                        </ul>
                    `,
                    en: `
                        <h2>Chapter 5: Computer Organization</h2>
                        <h3>1. Subsystems</h3>
                        <ul>
                            <li><strong>CPU (Central Processing Unit):</strong> The "brain" of the computer.
                                <ul>
                                    <li><strong>Components:</strong> ALU, Control Unit, and <span class="highlight">Registers</span>.</li>
                                    <li><strong>Key Registers:</strong>
                                        <ul>
                                            <li><strong>PC (Program Counter):</strong> Holds the address of the next instruction to be executed.</li>
                                            <li><strong>IR (Instruction Register):</strong> Holds the current instruction being decoded and executed.</li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                            <li><strong>Main Memory:</strong>
                                <ul>
                                    <li>Stores the currently running programs and data. Usually RAM (Random Access Memory).</li>
                                    <li><span class="highlight">Memory Hierarchy:</span> <strong>Registers → Cache → Main Memory → Storage (Hard Drive)</strong>. Speed and cost decrease, while capacity increases.</li>
                                    <li><strong>Cache:</strong> A small, super-fast buffer memory between the CPU and RAM to speed up access to frequently used data.</li>
                                </ul>
                            </li>
                            <li><strong>I/O (Input/Output) Subsystem:</strong> Consists of peripheral devices and their controllers that connect them to the computer.</li>
                        </ul>
                        <h3>2. Machine Cycle</h3>
                        <ul>
                             <li>The repetitive process by which the CPU executes one instruction. Consists of 3 basic steps:
                                <ol>
                                    <li><span class="highlight">Fetch:</span> The CPU fetches the instruction from memory into the IR.</li>
                                    <li><span class="highlight">Decode:</span> The Control Unit decodes the instruction in the IR to determine what action to take.</li>
                                    <li><span class="highlight">Execute:</span> The ALU or another component performs the requested operation.</li>
                                </ol>
                            </li>
                        </ul>
                    `
                },
                questions: [
                    // --- Start Chapter 5 Questions ---
                    { q: { vi: "Ba thành phần chính của CPU (Central Processing Unit) là gì?", en: "What are the three main components of a CPU (Central Processing Unit)?" }, o: [{ vi: "RAM, ROM, và Cache", en: "RAM, ROM, and Cache" }, { vi: "Data Bus, Address Bus, và Control Bus", en: "Data Bus, Address Bus, and Control Bus" }, { vi: "Đơn vị Số học và Logic (ALU), Đơn vị Điều khiển (Control Unit), và các Thanh ghi (Registers)", en: "Arithmetic Logic Unit (ALU), Control Unit, and Registers" }, { vi: "Input, Process, và Output", en: "Input, Process, and Output" }], a: 2, explanation: { vi: "CPU có bộ phận tính toán (ALU), bộ phận chỉ huy (Control Unit), và bộ nhớ siêu nhanh tại chỗ (Registers).", en: "The CPU has a calculation part (ALU), a command part (Control Unit), and super-fast local memory (Registers)." } },
                    { q: { vi: "Chức năng chính của Program Counter (PC) là gì?", en: "What is the main function of the Program Counter (PC)?" }, o: [{ vi: "Lưu dữ liệu tạm thời", en: "To store temporary data" }, { vi: "Giữ địa chỉ lệnh tiếp theo cần thực thi", en: "To hold the address of the next instruction to be executed" }, { vi: "Thực hiện phép toán số học", en: "To perform arithmetic operations" }, { vi: "Điều khiển tốc độ bus", en: "To control the bus speed" }], a: 1, explanation: { vi: "PC luôn 'trỏ' đến lệnh tiếp theo, đảm bảo chương trình chạy một cách tuần tự.", en: "The PC always 'points' to the next instruction, ensuring the program runs sequentially." } },
                    // ... (Thêm các câu hỏi khác của Chương 5 vào đây)
                ]
            }
        };
        // --- END: NGÂN HÀNG CÂU HỎI VÀ LÝ THUYẾT ---


        // --- START: JAVASCRIPT LOGIC (HOÀN CHỈNH) ---
        let currentLang = 'vi';
        let currentChapter = 'chapter1';
        let quizState = {};

        document.addEventListener('DOMContentLoaded', () => {
            renderAllContent();
        });

        function renderAllContent() {
            const tabContent = document.querySelector('.tab-content');
            tabContent.innerHTML = '';
            let isFirstChapter = true;
            for (const chapterId in contentData) {
                const chapterDiv = document.createElement('div');
                chapterDiv.id = chapterId;
                chapterDiv.className = isFirstChapter ? 'tab-pane active' : 'tab-pane';
                isFirstChapter = false;

                chapterDiv.innerHTML = `
                    <div class="theory-view">
                        <div class="theory-content"></div>
                        <div class="button-group">
                            <button class="primary-button" onclick="showQuizSetup('${chapterId}')" data-lang-key="startQuiz"></button>
                            <button class="info-button" onclick="askAI()" data-lang-key="askAI"></button>
                        </div>
                    </div>
                    <div class="quiz-view">
                        <div class="quiz-setup">
                            <h3 data-lang-key="quizSetupTitle"></h3>
                            <div>
                                <label data-lang-key="numQuestions"></label>
                                <input type="number" id="num-questions-${chapterId}" value="10" min="1" max="${contentData[chapterId].questions.length}">
                            </div>
                            <div>
                                <button class="primary-button" onclick="startQuiz('${chapterId}')" data-lang-key="start"></button>
                                <button class="secondary-button" onclick="showTheory('${chapterId}')" data-lang-key="backToTheory"></button>
                            </div>
                        </div>
                        <div class="quiz-container" style="display:none;">
                            <div id="question-text-${chapterId}" class="quiz-question"></div>
                            <div id="quiz-options-${chapterId}" class="quiz-options"></div>
                            <div id="explanation-${chapterId}"></div>
                            <div class="button-group">
                                <button onclick="nextQuestion('${chapterId}')" id="next-btn-${chapterId}" class="primary-button" data-lang-key="nextQuestion" style="display:none;"></button>
                            </div>
                        </div>
                        <div class="quiz-results" style="display:none;">
                            <h3 data-lang-key="resultsTitle"></h3>
                            <p id="score-${chapterId}"></p>
                            <button class="secondary-button" onclick="showTheory('${chapterId}')" data-lang-key="backToTheory"></button>
                            <button class="primary-button" onclick="showQuizSetup('${chapterId}')" data-lang-key="retakeQuiz"></button>
                        </div>
                    </div>
                `;
                tabContent.appendChild(chapterDiv);
            }
            updateAllVisibleText();
        }

        function switchTab(chapterId) {
            currentChapter = chapterId;
            document.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('active'));
            document.getElementById(chapterId).classList.add('active');
            
            document.querySelectorAll('.tab-link').forEach(l => l.classList.remove('active'));
            document.querySelector(`.tab-link[onclick="switchTab('${chapterId}')"]`).classList.add('active');
        }

        function switchLanguage(lang) {
            if (currentLang === lang) return;
            currentLang = lang;
            document.querySelectorAll('.lang-switcher button').forEach(b => b.classList.remove('active'));
            document.querySelector(`.lang-switcher button[onclick="switchLanguage('${lang}')"]`).classList.add('active');
            updateAllVisibleText();
        }
        
        const translations = {
            vi: {
                title: "CSI FPTU - Công cụ Ôn tập Nâng cao",
                subtitle: "Chọn chương để học lý thuyết hoặc làm bài tập trắc nghiệm.",
                vietnamese: "Tiếng Việt", english: "English",
                ch1: "Chương 1", ch2: "Chương 2", ch3: "Chương 3", ch4: "Chương 4", ch5: "Chương 5",
                startQuiz: "Làm bài tập", quizSetupTitle: "Thiết lập bài trắc nghiệm",
                numQuestions: "Số lượng câu hỏi:", start: "Bắt đầu",
                backToTheory: "Quay lại Lý thuyết", nextQuestion: "Câu tiếp theo",
                resultsTitle: "Kết quả", scoreText: "Bạn đã trả lời đúng",
                retakeQuiz: "Làm lại bài", askAI: "Hỏi AI"
            },
            en: {
                title: "CSI FPTU - Advanced Study Tool",
                subtitle: "Select a chapter to study theory or take a multiple-choice quiz.",
                vietnamese: "Vietnamese", english: "English",
                ch1: "Chapter 1", ch2: "Chapter 2", ch3: "Chapter 3", ch4: "Chapter 4", ch5: "Chapter 5",
                startQuiz: "Start Quiz", quizSetupTitle: "Quiz Setup",
                numQuestions: "Number of questions:", start: "Start",
                backToTheory: "Back to Theory", nextQuestion: "Next Question",
                resultsTitle: "Results", scoreText: "You answered correctly",
                retakeQuiz: "Retake Quiz", askAI: "Ask AI"
            }
        };

        function updateAllVisibleText() {
            document.querySelectorAll('[data-lang-key]').forEach(el => {
                const key = el.getAttribute('data-lang-key');
                if (translations[currentLang][key]) {
                    el.textContent = translations[currentLang][key];
                }
            });

            for (const chapterId in contentData) {
                const theoryDiv = document.querySelector(`#${chapterId} .theory-content`);
                if (theoryDiv) {
                    theoryDiv.innerHTML = contentData[chapterId].theory[currentLang];
                }
            }

            if (quizState[currentChapter] && quizState[currentChapter].isActive) {
                redisplayCurrentQuestion();
            }
        }

        function redisplayCurrentQuestion() {
            const state = quizState[currentChapter];
            if (!state || !state.isActive || state.currentQuestionIndex >= state.questions.length) return;

            const question = state.questions[state.currentQuestionIndex];
            document.getElementById(`question-text-${currentChapter}`).textContent = `(${state.currentQuestionIndex + 1}/${state.questions.length}) ${question.q[currentLang]}`;
            
            const options = document.querySelectorAll(`#quiz-options-${currentChapter} button`);
            options.forEach((button, index) => {
                button.textContent = question.o[index][currentLang];
            });

            const explanationDiv = document.getElementById(`explanation-${currentChapter}`);
            if (explanationDiv.innerHTML !== '') {
                const explanationText = question.explanation ? question.explanation[currentLang] : '';
                explanationDiv.innerHTML = `<div class="explanation-box"><strong>💡 ${currentLang === 'vi' ? 'Giải thích' : 'Explanation'}:</strong> ${explanationText}</div>`;
            }
        }
        
        function showQuizSetup(chapterId) {
            document.querySelector(`#${chapterId} .theory-view`).style.display = 'none';
            document.querySelector(`#${chapterId} .quiz-view`).style.display = 'block';
            document.querySelector(`#${chapterId} .quiz-setup`).style.display = 'block';
            document.querySelector(`#${chapterId} .quiz-container`).style.display = 'none';
            document.querySelector(`#${chapterId} .quiz-results`).style.display = 'none';
        }

        function showTheory(chapterId) {
            if(quizState[chapterId]) quizState[chapterId].isActive = false;
            document.querySelector(`#${chapterId} .theory-view`).style.display = 'block';
            document.querySelector(`#${chapterId} .quiz-view`).style.display = 'none';
        }

        function startQuiz(chapterId) {
            const allQuestions = contentData[chapterId].questions;
            const numQuestionsInput = document.getElementById(`num-questions-${chapterId}`);
            let numQuestions = parseInt(numQuestionsInput.value);
            if (isNaN(numQuestions) || numQuestions <= 0) numQuestions = 10;
            numQuestions = Math.min(numQuestions, allQuestions.length);
            
            const questions = [...allQuestions].sort(() => 0.5 - Math.random()).slice(0, numQuestions);

            quizState[chapterId] = { questions, currentQuestionIndex: 0, score: 0, isActive: true };

            document.querySelector(`#${chapterId} .quiz-setup`).style.display = 'none';
            document.querySelector(`#${chapterId} .quiz-container`).style.display = 'block';
            document.querySelector(`#${chapterId} .quiz-results`).style.display = 'none';
            
            displayQuestion(chapterId);
        }

        function displayQuestion(chapterId) {
            const state = quizState[chapterId];
            if (state.currentQuestionIndex >= state.questions.length) {
                showResults(chapterId);
                return;
            }

            const question = state.questions[state.currentQuestionIndex];
            document.getElementById(`question-text-${chapterId}`).textContent = `(${state.currentQuestionIndex + 1}/${state.questions.length}) ${question.q[currentLang]}`;
            
            const optionsDiv = document.getElementById(`quiz-options-${chapterId}`);
            optionsDiv.innerHTML = '';
            question.o.forEach((option, index) => {
                const button = document.createElement('button');
                button.textContent = option[currentLang];
                button.onclick = () => selectAnswer(chapterId, index);
                optionsDiv.appendChild(button);
            });

            document.getElementById(`explanation-${chapterId}`).innerHTML = '';
            document.getElementById(`next-btn-${chapterId}`).style.display = 'none';
        }

        function selectAnswer(chapterId, selectedIndex) {
            const state = quizState[chapterId];
            const question = state.questions[state.currentQuestionIndex];
            const correctIndex = question.a;
            
            const options = document.querySelectorAll(`#${chapterId} .quiz-options button`);
            options.forEach(button => button.disabled = true);

            if (selectedIndex === correctIndex) {
                options[selectedIndex].classList.add('correct');
                state.score++;
            } else {
                options[selectedIndex].classList.add('incorrect');
                options[correctIndex].classList.add('correct');
                const explanationDiv = document.getElementById(`explanation-${chapterId}`);
                if(question.explanation) {
                    explanationDiv.innerHTML = `<div class="explanation-box"><strong>💡 ${currentLang === 'vi' ? 'Giải thích' : 'Explanation'}:</strong> ${question.explanation[currentLang]}</div>`;
                }
            }
            document.getElementById(`next-btn-${chapterId}`).style.display = 'inline-block';
        }

        function nextQuestion(chapterId) {
            quizState[chapterId].currentQuestionIndex++;
            displayQuestion(chapterId);
        }

        function showResults(chapterId) {
            const state = quizState[chapterId];
            state.isActive = false;
            document.querySelector(`#${chapterId} .quiz-container`).style.display = 'none';
            const resultsDiv = document.querySelector(`#${chapterId} .quiz-results`);
            resultsDiv.style.display = 'block';
            
            const scoreText = translations[currentLang].scoreText;
            document.getElementById(`score-${chapterId}`).textContent = `${scoreText} ${state.score} / ${state.questions.length} câu.`;
        }

        function askAI() {
            const activeChapter = document.querySelector('.tab-pane.active');
            const titleElement = activeChapter.querySelector('.theory-content h2');
            if (titleElement) {
                const topic = titleElement.textContent.trim();
                const searchQuery = encodeURIComponent(topic + (currentLang === 'vi' ? ' giải thích chi tiết' : ' detailed explanation'));
                const url = `https://www.google.com/search?q=${searchQuery}`;
                window.open(url, '_blank');
            }
        }
    </script>
    </body>
</html>
